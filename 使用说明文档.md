# 气压测控仿真系统使用说明文档

## 1. 系统概述

本系统是一个基于Arduino UNO的气压测控仿真系统，由PC上位机软件和Arduino下位机程序组成，用于实现远程气压检测和自动控制功能。

### 1.1 系统组成
- **PC上位机软件**：基于Python开发的GUI应用程序
- **Arduino下位机**：基于Arduino UNO的气压检测和控制系统
- **Proteus仿真环境**：用于硬件电路仿真
- **虚拟串口**：用于PC与Arduino之间的通信

### 1.2 主要功能
- 双向串口通信
- 学号发送和接收确认
- 实时气压监测
- 气压阈值自动控制
- LCD数据显示
- 直流电机控制

## 2. 软件环境准备

### 2.1 必需软件
1. **Python 3.7+** - 运行PC上位机软件
2. **Arduino IDE** - 编译和上传Arduino程序
3. **Proteus 8.9 SP2+** - 硬件电路仿真
4. **Virtual Serial Port Driver (VSPD)** - 创建虚拟串口

### 2.2 Python环境安装

#### 2.2.1 安装Python
1. 下载Python 3.7或更高版本：https://www.python.org/
2. 安装时勾选"Add Python to PATH"
3. 验证安装：打开命令提示符，输入`python --version`

#### 2.2.2 安装依赖包
```bash
# 进入项目目录
cd D:\Atest

# 安装Python依赖包
pip install -r requirements.txt

# 或手动安装
pip install pyserial
```

## 3. 硬件电路搭建

### 3.1 Proteus电路连接
在Proteus中连接以下组件：

#### 3.1.1 主要组件
- **Arduino UNO**：微控制器核心
- **LCD1602**：液晶显示器（I2C接口）
- **电位器**：模拟气压输入（A0引脚）
- **直流电机**：控制执行器
- **ULN2003驱动器**：电机驱动电路
- **COMPIM**：串口通信组件

#### 3.1.2 电路连接
```
Arduino UNO连接：
- A0: 电位器中间引脚（模拟气压输入）
- D9: ULN2003输入端（电机控制）
- SDA (A4): LCD1602 SDA引脚
- SCL (A5): LCD1602 SCL引脚
- RXD: COMPIM TXD
- TXD: COMPIM RXD
- GND: 公共地线

LCD1602 (I2C):
- VCC: 5V
- GND: GND
- SDA: Arduino SDA (A4)
- SCL: Arduino SCL (A5)

电机驱动：
- ULN2003输入: Arduino D9
- ULN2003输出: 直流电机正极
- 电机负极: GND
```

## 4. 虚拟串口配置

### 4.1 使用VSPD创建串口对
1. 启动VSPD软件
2. 选择第一个串口（如COM1）
3. 选择第二个串口（如COM2）
4. 点击"Add pair"创建串口对
5. 验证串口对创建成功

### 4.2 Proteus串口配置
1. 在Proteus中添加COMPIM组件
2. 双击COMPIM组件进行配置：
   - Physical Port: COM1
   - Baud Rate: 9600
   - Data Bits: 8
   - Parity: None
   - Stop Bits: 1

## 5. Arduino程序使用

### 5.1 程序文件说明
- `气压测控系统.ino` - 完整版（支持BMP280传感器）
- `气压测控系统_无传感器版.ino` - Proteus仿真版（推荐使用）

### 5.2 编译和上传
1. 打开Arduino IDE
2. 加载程序文件（推荐使用无传感器版）
3. 选择开发板：Arduino UNO
4. 选择串口：COM1（与Proteus对应的串口）
5. 编译并上传程序

### 5.3 程序功能
- 接收PC发送的学号
- 计算气压阈值（860 + 学号末位数）
- 读取模拟气压值（A0引脚）
- 根据阈值控制直流电机
- LCD显示学号和气压值
- 串口发送气压数据

## 6. PC上位机软件使用

### 6.1 启动软件
```bash
# 进入项目目录
cd D:\Atest

# 运行PC上位机软件
python PressureControlSystem.py
```

### 6.2 个性化设置
**重要：请修改软件中的个人信息**

打开`PressureControlSystem.py`文件，找到以下行并修改：
```python
# 第25-26行，修改为你的学号和姓名
self.student_name = "你的姓名"
self.student_id = "你的学号"

# 第418行，修改窗口标题
# root.title("气压测控仿真系统 - 学号：你的学号 姓名：你的姓名")
```

### 6.3 软件界面操作

#### 6.3.1 串口连接
1. 在"串口设置"区域选择串口（COM2）
2. 波特率设为9600
3. 点击"连接串口"按钮
4. 观察状态栏显示连接成功

#### 6.3.2 发送学号
1. 在"学号输入"框中输入你的学号
2. 点击"发送学号"按钮
3. 观察发送记录和接收区域确认

#### 6.3.3 监测气压
1. 在Proteus中调节电位器改变气压值
2. 观察PC软件显示的实时气压数据
3. 观察LCD显示器显示内容
4. 验证电机控制逻辑

### 6.4 软件功能说明

#### 6.4.1 主要功能区
- **串口设置**：选择和配置串口连接
- **学号发送**：输入和发送学号到Arduino
- **气压数据接收**：显示实时气压值和历史记录

#### 6.4.2 界面元素
- **标题栏**：显示学生学号和姓名
- **发送记录**：显示已发送的学号信息
- **当前气压**：大字体显示最新气压值
- **接收记录**：显示所有接收到的数据
- **状态栏**：显示当前连接状态和操作结果

## 7. 系统测试流程

### 7.1 基础测试
1. **连接测试**：验证PC与Arduino串口通信
2. **学号发送测试**：验证学号传输和显示
3. **气压监测测试**：验证气压数据采集和显示
4. **电机控制测试**：验证阈值控制逻辑

### 7.2 完整测试流程
1. 启动Proteus仿真
2. 启动PC上位机软件
3. 连接串口
4. 发送学号（如：202100001）
5. 观察LCD显示："ID: 202100001"
6. 调节电位器改变气压值
7. 观察PC软件气压显示
8. 验证电机控制：气压≥865hPa时电机启动

### 7.3 预期结果
- PC发送学号后，Arduino在LCD显示学号
- Arduino持续向PC发送气压数据
- PC软件实时显示气压值
- 气压超过阈值时，电机自动启动
- 气压低于阈值时，电机自动停止

## 8. 常见问题解决

### 8.1 串口连接问题
**问题**：无法连接串口
**解决方法**：
- 检查VSPD虚拟串口是否创建成功
- 确认Proteus COMPIM配置正确
- 检查串口是否被其他程序占用

### 8.2 数据接收问题
**问题**：PC软件无法接收气压数据
**解决方法**：
- 确认Arduino程序已正确上传
- 检查波特率设置是否一致（9600）
- 验证Proteus中电路连接正确

### 8.3 LCD显示问题
**问题**：LCD无法正常显示
**解决方法**：
- 检查I2C地址是否正确（0x27）
- 确认SDA/SCL引脚连接正确
- 检查LCD电源连接

### 8.4 电机控制问题
**问题**：电机无法正常启动
**解决方法**：
- 检查电机驱动电路连接
- 确认控制引脚（D9）连接正确
- 验证气压阈值计算是否正确

## 9. 扩展功能建议

### 9.1 功能增强
- 添加数据记录和导出功能
- 增加气压历史曲线显示
- 添加报警阈值设置
- 实现多路传感器监测

### 9.2 界面优化
- 添加仪表盘显示
- 优化数据可视化
- 增加深色主题
- 添加快捷键支持

## 10. 技术支持

如遇到技术问题，请检查：
1. 软件环境是否正确安装
2. 电路连接是否正确
3. 程序代码是否正确编译
4. 串口配置是否正确

**开发日期**：2024年
**适用课程**：嵌入式系统设计、单片机原理与应用
**开发平台**：Arduino + Python + Proteus